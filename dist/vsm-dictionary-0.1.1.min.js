!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["vsm-dictionary"]=t():e.VsmDictionary=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";function r(e){return void 0===e}Object.defineProperty(t,"__esModule",{value:!0}),t.undef=r,t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.strcmp=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(e=e.toLowerCase(),t=t.toLowerCase());return e>t?1:e<t?-1:0},t.asArray=function(e){return r(e)?[]:[].concat(e)},t.limitBetween=function(e,t,n){return null!=t&&e<t?t:null!=n&&e>n?n:e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=n(3),o=n(2),u=(r=n(5))&&r.__esModule?r:{default:r},a=n(0);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s="to implement by a subclass",f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t||{};this.numberMatchConfig=(0,a.undef)(n.numberMatchConfig)?{dictID:"00",conceptIDPrefix:"00:"}:n.numberMatchConfig,this.fixedTermsCache={}}var t,n,r;return t=e,(n=[{key:"loadFixedTerms",value:function(e,t,n){var r=this;if(!(e=this._prepIdts(e)).length)return(0,i.callAsync)(n,null);var o=t?(0,a.deepClone)(t):{};o.filter||(o.filter={}),o.filter.i=e.map(function(e){return e.i}),o.page=1,o.perPage=e.length,this.getEntries(o,function(t,o){if(t)return(0,i.callAsync)(n,t);e.forEach(function(e){var t=o.items.find(function(t){return t.i==e.i});if(t){var n=t.t.findIndex(function(t){return t.s==e.s});-1==n&&(n=0);var i=r._idtToFTCacheKey(e.i,e.s||"");r.fixedTermsCache[i]=r._entryToMatch(t,n,"F")}}),(0,i.callAsync)(n,null)})}},{key:"_prepIdts",value:function(e){return(0,a.asArray)(e).map(function(e){return e.i?e:{i:e}})}},{key:"_idtToFTCacheKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e,"\n").concat(t)}},{key:"_entryToMatch",value:function(e,t,n){return Object.assign({},e,e.t[t],{w:n})}},{key:"addExtraMatchesForString",value:function(e,t,n,r){if(n&&(n.page||1)>1)return(0,i.callAsync)(r,null,t);t=t.slice(0);var o=this._getFTMatchesForString(e,n);if(o.length){var u=!(!t[0]||"R"!=t[0].w)&&t.shift();t=o.concat(t),u&&t.unshift(u),t=t.reduce(function(e,n,r){return r==t.findIndex(function(e){return n.i==e.i&&n.s==e.s})&&e.push(n),e},[])}if(u=this._getNumberMatchForString(e)){var a=t.findIndex(function(e){return e.i==u.i});a>=0&&(u=t.splice(a,1)[0]),t.unshift(u),u.w="N"}(0,i.callAsync)(r,null,t)}},{key:"_getFTMatchesForString",value:function(e,t){var n=this;if(!t||!t.idts)return[];var r=[];e=e.toLowerCase();return r=(r=this._prepIdts(t.idts).reduce(function(t,r){var i=n._idtToFTCacheKey(r.i,r.s||""),o=n.fixedTermsCache[i];if(!o)return t;var u=o.s.toLowerCase().startsWith(e)?"F":o.s.toLowerCase().includes(e)?"G":0;return u&&t.push(Object.assign((0,a.deepClone)(o),{w:u})),t},r)).sort(function(e,t){return(0,a.strcmp)(e.w,t.w)||(0,a.strcmp)(e.s,t.s)||(0,a.strcmp)(e.d,t.d)||e.i-t.i}),(0,o.zPropPrune)(r,t.z)}},{key:"_getNumberMatchForString",value:function(e){if(!this.numberMatchConfig||!e)return!1;var t=(0,u.default)(e);return!1!==t&&{i:this.numberMatchConfig.conceptIDPrefix+t,d:this.numberMatchConfig.dictID,s:e,x:"[number]",w:"N"}}},{key:"addDictInfos",value:function(e,t){t(s)}},{key:"addEntries",value:function(e,t){t(s)}},{key:"addRefTerms",value:function(e,t){t(s)}},{key:"updateDictInfos",value:function(e,t){t(s)}},{key:"updateEntries",value:function(e,t){t(s)}},{key:"deleteDictInfos",value:function(e,t){t(s)}},{key:"deleteEntries",value:function(e,t){t(s)}},{key:"deleteRefTerms",value:function(e,t){t(s)}},{key:"getDictInfos",value:function(e,t){t(s)}},{key:"getEntries",value:function(e,t){t(s)}},{key:"getRefTerms",value:function(e){e(s)}},{key:"getMatchesForString",value:function(e,t,n){n(s)}}])&&c(t.prototype,n),r&&c(t,r),e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepGetOptions=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=Object.assign({},e||{});i.filter=Object.assign({},i.filter||{}),t.forEach(function(e){return i.filter[e]=o(i.filter[e])}),n&&(i.sort=Object.assign({},i.sort||{}),n.forEach(function(e){return i.sort[e]=o(i.sort[e])}));return i;function o(e){return!!e&&(0,r.asArray)(e)}},t.arrayQuery=function(e,t,n,u,a){u=(0,r.limitBetween)(u||1,1,null),a=(0,r.limitBetween)(a||i,1,o);var c=(u-1)*a;return e.filter(t).sort(n).slice(c,c+a)},t.zPropPrune=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!0!==t&&(t=!1===t?[]:(0,r.asArray)(t),e=e.map(function(e){if((0,r.undef)(e.z))return e;var n=Object.assign({},e,{z:{}});return t.forEach(function(t){(0,r.undef)(e.z[t])||(n.z[t]=e.z[t])}),Object.keys(n.z).length||delete n.z,n}));return e};var r=n(0),i=20,o=100},function(e,t,n){"use strict";function r(e,t,n){var r=[],i=[],o=e.length;if(!o)return n(null,r);e.forEach(function(e,u){return t(e,function(e,t){i[u]=e,r[u]=t,--o||n(i.every(function(e){return null===e})?null:i,r)})})}function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];setTimeout(function(){return e.apply(void 0,n)},0)}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncMap=r,t.callAsync=i,t.callAsyncForOneOrEach=function(e,t,n){Array.isArray(e)?r(e,function(e,n){return o(t)(e,o(n))},o(n)):o(t)(e,o(n));function o(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.apply(void 0,[e].concat(n))}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Dictionary",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"DictionaryLocal",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"DictionaryRemoteDemo",{enumerable:!0,get:function(){return o.default}});var r=u(n(1)),i=u(n(6)),o=u(n(8));function u(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.match(r);if(null===t)return!1;var n="-"===t[1]?"-":"",o=t[2],u=t[3]||"0";"+"===u[0]&&(u=u.substr(1));var a=o.indexOf(".");a<0&&(a=o.length);var c=o.replace(/\./g,"");if(!c||c.length<o.length-1)return!1;var s=c.search(/[1-9]/);if(s<0)return"0e+0";u=i(u,(a-1-s).toString()),(o=c.substr(s).replace(/0+$/,"")).length>1&&(o=o[0]+"."+o.substr(1));return n+o+"e"+("-"!=u[0]?"+":"")+u.toString()},t.addBigInts=i;var r=/^([+\-])?([0-9\.]+)(?:[e|E]([+\-]?[0-9]+))?$/;function i(e,t){var n="-"===e[0]?1:0,r="-"===t[0]?1:0;n&&(e=e.substr(1)),r&&(t=t.substr(1));var i=n===r;if(e=e.replace(/^0+/,""),t=t.replace(/^0+/,""),""===e&&""===t||!i&&e===t)return"0";if(!i&&(e.length<t.length||e.length===t.length&&e<t)){var o=e;e=t,t=o,n=r}e=e.split(""),t=t.split("");for(var u=0,a="";e.length||t.length||u;)a=((u=~~e.pop()+(i?~~t.pop()+u:-~~t.pop()-u))+10)%10+a,u=i?u>9:u<0;return(n?"-":"")+a.replace(/^0+/,"")}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Dictionary2=_interopRequireDefault(__webpack_require__(1)),_async=__webpack_require__(3),_canonicalize=__webpack_require__(7),_arrayQuery=__webpack_require__(2),_util=__webpack_require__(0);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:_get(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var msgAbsentDictInfo=function(e){return"dictInfo for '".concat(e,"' does not exist")},msgAbsentEntry=function(e){return"entry for '".concat(e,"' does not exist")},msgAbsentRefTerm=function(e){return"refTerm '".concat(e,"' does not exist")},msgNoSuchDictID=function(e){return"entry is linked to non-existent dictID '".concat(e,"'")},f_id_numLength=4,DictionaryLocal=function(_Dictionary){function DictionaryLocal(e){var t;_classCallCheck(this,DictionaryLocal);var n=e||{};if((t=_possibleConstructorReturn(this,(DictionaryLocal.__proto__||Object.getPrototypeOf(DictionaryLocal)).call(this,n))).dictInfos=[],t.entries=[],t.refTerms=[],n.dictData||n.refTerms){var r=t.addDictionaryData(n.dictData||[],n.refTerms);if(r)throw r}return t}return _inherits(DictionaryLocal,_Dictionary),_createClass(DictionaryLocal,[{key:"addDictInfos",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._addDictInfo.bind(this),this._cbDict(t))}},{key:"updateDictInfos",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._updateDictInfo.bind(this),this._cbDict(t))}},{key:"deleteDictInfos",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._deleteDictInfo.bind(this),t)}},{key:"addEntries",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._addEntry.bind(this),this._cbEntr(t))}},{key:"updateEntries",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._updateEntry.bind(this),this._cbEntr(t))}},{key:"deleteEntries",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._deleteEntry.bind(this),t)}},{key:"addRefTerms",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._addRefTerm.bind(this),t)}},{key:"deleteRefTerms",value:function(e,t){(0,_async.callAsyncForOneOrEach)(e,this._deleteRefTerm.bind(this),t)}},{key:"addDictionaryData",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=function(e){return e},o=[];return n.forEach(function(n){(e=t._addDictInfo(n,i))&&(e=t._updateDictInfo(n,i)),e&&o.push(e),(n.entries||[]).forEach(function(r){if(r.d){if(r.d!==n.id)return o.push("an entry tries to override dictID '".concat(n.id,"'"))}else r.d=n.id;r.i=t._makeStringConceptID(n,r),(e=t._addEntry(r,i))&&(e=t._updateEntry(r,i)),e&&o.push(e)})}),this._sortEntries(),r.forEach(function(n){(e=t._addRefTerm(n,i))&&o.push(e)}),o.length?o:null}},{key:"_cbDict",value:function(e){var t=this;return function(){t._sortDictInfos(),e.apply(void 0,arguments)}}},{key:"_cbEntr",value:function(e){var t=this;return function(){t._sortEntries(),e.apply(void 0,arguments)}}},{key:"_addDictInfo",value:function _addDictInfo(di,cb){if(!di.id||!di.name)return cb("dictInfo misses a required property: id or name");if(this._indexOfDictInfo(di.id)>=0)return cb("dictInfo for '".concat(di.id,"' already exists"));var dictInfo={id:di.id,name:di.name};return di.f_aci&&eval("dictInfo.f_aci = "+di.f_aci),di.f_id&&eval("dictInfo.f_id  = "+di.f_id),this.dictInfos.push(dictInfo),cb(null)}},{key:"_updateDictInfo",value:function(e,t){var n=this._indexOfDictInfo(e.id);if(n<0)return t(msgAbsentDictInfo(e.id),null);var r=Object.assign({},this.dictInfos[n]);return e.name&&(r.name=e.name),t(null,this.dictInfos[n]=r)}},{key:"_deleteDictInfo",value:function(e,t){var n=this._indexOfDictInfo(e);return n<0?t(msgAbsentDictInfo(e)):this.entries.find(function(t){return t.d==e})?t("dictInfo for '".concat(e,"' still has associated entries")):(this.dictInfos.splice(n,1),void t(null))}},{key:"_indexOfDictInfo",value:function(e){return this.dictInfos.findIndex(function(t){return t.id==e})}},{key:"_sortDictInfos",value:function(){this.dictInfos.sort(function(e,t){return(0,_util.strcmp)(e.id,t.id)})}},{key:"_addEntry",value:function(e,t){if(!e.i||!e.d||!e.t)return t("entry misses a required property: i, d, or t");var n=this.dictInfos[this._indexOfDictInfo(e.d)];return n?(e.i=this._makeStringConceptID(n,e),this._indexOfEntry(e.i)>=0?t("entry for '".concat(e.i,"' already exists")):(e=(0,_canonicalize.canonicalizeEntry)(e)).t.filter(function(e){return!e.s}).length?t("invalid term"):(this.entries.push(e),t(null))):t(msgNoSuchDictID(e.d))}},{key:"_updateEntry",value:function(e,t){var n=this._indexOfEntry(e.i);if(n<0)return t(msgAbsentEntry(e.i),null);if(e.d&&this._indexOfDictInfo(e.d)<0)return t(msgNoSuchDictID(e.d),null);var r=(0,_util.deepClone)(this.entries[n]);e.d&&(r.d=e.d),e.x&&(r.x=e.x);var i=(0,_util.asArray)(e.tdel);return r.t=r.t.filter(function(e){return!i.includes(e.s)}),!0===e.zdel?delete r.z:(0,_util.asArray)(e.zdel).forEach(function(e){return delete r.z[e]}),(0,_canonicalize.canonicalizeTerms)(e.t||[]).forEach(function(e){var t=r.t.findIndex(function(t){return t.s==e.s});t>=0?r.t[t]=e:r.t.push(e)}),r.t.length?(e.z&&(r.z=Object.assign(r.z||{},(0,_util.deepClone)(e.z))),t(null,this.entries[n]=r)):t("entry would have no terms left",null)}},{key:"_deleteEntry",value:function(e,t){var n=this._indexOfEntry(e);if(n<0)return t(msgAbsentEntry(e));this.entries.splice(n,1),t(null)}},{key:"_makeStringConceptID",value:function(e,t){return"number"!=typeof t.i?t.i:(e.f_id||this._default_f_id)(e,t)}},{key:"_default_f_id",value:function(e,t){return e.id+":"+t.i.toString().padStart(f_id_numLength,"0")}},{key:"_indexOfEntry",value:function(e){return this.entries.findIndex(function(t){return t.i==e})}},{key:"_sortEntries",value:function(){this.entries.sort(function(e,t){return(0,_util.strcmp)(e.d,t.d)||(0,_util.strcmp)(e.i,t.i)})}},{key:"_addRefTerm",value:function(e,t){return e?(this.refTerms=_toConsumableArray(new Set(this.refTerms.concat(e))).sort(),t(null)):t("empty refTerm")}},{key:"_deleteRefTerm",value:function(e,t){var n=this.refTerms.indexOf(e);if(n<0)return t(msgAbsentRefTerm(e));this.refTerms.splice(n,1),t(null)}},{key:"getDictInfos",value:function(e,t){var n=(0,_arrayQuery.prepGetOptions)(e,["id","name"]),r="name"==n.sort?function(e,t){return(0,_util.strcmp)(e.name,t.name)}:function(e,t){return(0,_util.strcmp)(e.id,t.id)},i=(0,_arrayQuery.arrayQuery)(this.dictInfos,function(e){return(!n.filter.id||n.filter.id.includes(e.id))&&(!n.filter.name||n.filter.name.includes(e.name))},r,n.page,n.perPage);(0,_async.callAsync)(t,null,{items:i})}},{key:"getEntries",value:function(e,t){var n=(0,_arrayQuery.prepGetOptions)(e,["i","d"]),r="i"==n.sort?function(e,t){return(0,_util.strcmp)(e.i,t.i)}:"s"==n.sort?function(e,t){return(0,_util.strcmp)(e.t[0].s,t.t[0].s)||(0,_util.strcmp)(e.d,t.d)||(0,_util.strcmp)(e.i,t.i)}:function(e,t){return(0,_util.strcmp)(e.d,t.d)||(0,_util.strcmp)(e.i,t.i)},i=(0,_arrayQuery.arrayQuery)(this.entries,function(e){return(!n.filter.i||n.filter.i.includes(e.i))&&(!n.filter.d||n.filter.d.includes(e.d))},r,n.page,n.perPage);(0,_async.callAsync)(t,null,{items:(0,_arrayQuery.zPropPrune)(i,n.z)})}},{key:"getRefTerms",value:function(e,t){var n=(0,_arrayQuery.prepGetOptions)(e,["s"]),r=(0,_arrayQuery.arrayQuery)(this.refTerms,function(e){return!n.filter.s||n.filter.s.includes(e)},function(e,t){return(0,_util.strcmp)(e,t)},n.page,n.perPage);(0,_async.callAsync)(t,null,{items:r})}},{key:"getMatchesForString",value:function(e,t,n){var r=(0,_arrayQuery.prepGetOptions)(t,["d"],["d"]),i=[];if(e){e=e.toLowerCase(),this.entries.forEach(function(e){e.t.forEach(function(t,n){i.push({s:t.s,d:e.d,e:e,p:n,i:e.i})})});i=(0,_arrayQuery.arrayQuery)(i,function(t){if(r.filter.d&&!r.filter.d.includes(t.d))return!1;if(t.s.toLowerCase().startsWith(e))t.w="S";else{if(!t.s.toLowerCase().includes(e))return!1;t.w="T"}return t.D=r.sort.d&&r.sort.d.includes(t.d)?0:1,!0},function(e,t){return e.D-t.D||(0,_util.strcmp)(e.w,t.w)||(0,_util.strcmp)(e.s,t.s)||(0,_util.strcmp)(e.d,t.d)||e.p-t.p||e.i-t.i},r.page,r.perPage).map(function(e){return Object.assign({},e.e,e.e.t[e.p],{w:e.w})}),i=(0,_arrayQuery.zPropPrune)(i,r.z)}var o=this.refTerms.find(function(t){return t.toLowerCase()==e});o&&i.unshift({i:"",d:"",s:o,x:"[referring term]",w:"R"}),_get(DictionaryLocal.prototype.__proto__||Object.getPrototypeOf(DictionaryLocal.prototype),"addExtraMatchesForString",this).call(this,e,i,r,function(e,t){(0,_async.callAsync)(n,null,{items:e?i:t})})}}]),DictionaryLocal}(_Dictionary2.default);exports.default=DictionaryLocal},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canonicalizeEntry=function(e){var t={i:e.i,d:e.d};(0,r.undef)(e.x)||(t.x=e.x);t.t=o(e.t),(0,r.undef)(e.z)||(t.z=(0,r.deepClone)(e.z));return t},t.canonicalizeTerms=o;var r=n(0);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){var t=i(e);return("string"==t?[{s:e}]:"object"==t&&(0,r.undef)(e.length)?[u(e)]:e.map(function(e){return"string"==typeof e?{s:e}:u(e)})).reduce(function(e,t){for(var n=0;n<e.length;n++)if(e[n].s===t.s){e[n]=t;break}return n==e.length&&e.push(t),e},[])}function u(e){var t={s:e.s};return(0,r.undef)(e.y)||(t.y=e.y),(0,r.undef)(e.x)||(t.x=e.x),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(1))&&r.__esModule?r:{default:r},o=n(2);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e||{},i="http://test/",o="&p=$page&c=$perPage";return(n=function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r))).urlGetDictInfos=r.urlGetDictInfos||i+"dic?i=$filterI&n=$filterN&s=$sort"+o,n.urlGetEntries=r.urlGetEntries||i+"ent?i=$filterI&d=$filterD&z=$z&s=$sort"+o,n.urlGetRefTerms=r.urlGetRefTerms||i+"ref?f=$filterS"+o,n.urlGetMatches=r.urlGetMatches||i+"mat?s=$str&d=$filterD&s=$sortD"+o,n}var n,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n=t,(r=[{key:"getDictInfos",value:function(e,t){var n=this._prepGetOptions(e,["id","name"]),r=this.urlGetDictInfos.replace("$filterI",n.filter.id.join(",")).replace("$filterN",n.filter.name.join(",")).replace("$sort",n.sort).replace("$page",n.page).replace("$perPage",n.perPage);this._request(r,function(e,n){return t(e,{items:n})})}},{key:"getEntries",value:function(e,t){var n=this._prepGetOptions(e,["i","d"]),r=this.urlGetEntries.replace("$filterI",n.filter.i.join(",")).replace("$filterD",n.filter.d.join(",")).replace("$z",n.z.join(",")).replace("$sort",n.sort).replace("$page",n.page).replace("$perPage",n.perPage);this._request(r,function(e,n){return t(e,{items:n})})}},{key:"getRefTerms",value:function(e,t){var n=this._prepGetOptions(e,["s"]),r=this.urlGetRefTerms.replace("$filterS",n.filter.s.join(",")).replace("$page",n.page).replace("$perPage",n.perPage);this._request(r,function(e,n){return t(e,{items:n})})}},{key:"getMatchesForString",value:function(e,n,r){var i=this;if(!e)return r(null,{items:[]});var o=this._prepGetOptions(n,["d"],["d"]),u=this.urlGetMatches.replace("$str",encodeURIComponent(e)).replace("$filterD",o.filter.d.join(",")).replace("$sortD",o.sort.d.join(",")).replace("$z",o.z.join(",")).replace("$page",o.page).replace("$perPage",o.perPage);this._request(u,function(n,u){if(n)return r(n);(function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addExtraMatchesForString",i).call(i,e,u,o,function(e,t){r(null,{items:e?u:t})})})}},{key:"_prepGetOptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=(0,o.prepGetOptions)(e,t,n),i=encodeURIComponent;return t.forEach(function(e){r.filter[e]=(r.filter[e]||[]).map(function(e){return i(e)})}),n?n=n.forEach(function(e){r.sort[e]=(r.sort[e]||[]).map(function(e){return i(e)})}):r.sort=i(r.sort||""),r.z=void 0===r.z||!0===r.z?["true"]:r.z?[].concat(r.z).map(function(e){return i(e)}):["false"],r.page=i(r.page||""),r.perPage=i(r.perPage||""),r}},{key:"_getReqObj",value:function(){return new XMLHttpRequest}},{key:"_request",value:function(e,t){var n=this._getReqObj();n.onreadystatechange=function(){if(4==n.readyState)if(200!=n.status)t("Error: req.status = "+n.status);else try{t(null,JSON.parse(n.responseText))}catch(e){t(e)}},n.open("GET",e,!0),n.send()}}])&&a(n.prototype,r),c&&a(n,c),t}();t.default=c}])});